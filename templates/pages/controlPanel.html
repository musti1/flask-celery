{% extends "layout.html" %}
{% block content %}
    <div class="row" style="margin-top: 50px;">
        <div class="col-md-4 text-center">
            <div class="form-group select">
                <label for="selectTask">Tasks List :</label>
                <select class="form-control" id="selectTask">
                    <option selected disabled value="">Select Task</option>
                    <option value="long">Long Task</option>
                    <option value="fail">Fail Task</option>
                    <option value="counter">Counter Task</option>
                    <option value="addition">Addition Task</option>
                </select>
                <br>
            </div>
        </div>
        <div class="col-md-8 text-right" style="margin-top: 30px;">
            <div class="form-group button">
                <button id="startTask" type="button" class="btn btn-secondary">Start</button>
            </div>
        </div>
    </div>
    <div class="row" style="margin-top: 50px;">
        <div class="col-md-6 text-center">
            <div class="outer-form">
                <table id="table" class="table table-striped table-dark">
                    <thead>
                    <tr>
                        <th class="head">Task Name</th>
                        <th class="head">Status</th>
                        <th class="head">Attach/Detach</th>
                        <th class="head">Stop</th>

                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td style="padding: 14px;">Long Task</td>
                        <td style="padding: 14px;"><span id="longTaskStatus">stop</span></td>
                        <td><button id="longTaskOff">attach</button><button id="longTaskOff">detach</button></td>
                        <td>
                            <button id="longTaskOff">off</button>
                        </td>

                    </tr>
                    <tr>
                        <td style="padding: 14px;">Counter Task</td>
                        <td style="padding: 14px;"><span id="counterTaskStatus">stop</span></td>
                        <td><button id="longTaskOff">attach</button><button id="longTaskOff">detach</button></td>
                        <td>
                            <button id="counterTaskOff">off</button>
                        </td>

                    </tr>
                    <tr>
                        <td style="padding: 14px;">Addition Task</td>
                        <td style="padding: 14px;"><span id="additionTaskStatus">stop</span></td>
                        <td><button id="longTaskOff">attach</button><button id="longTaskOff">detach</button></td>
                        <td>
                            <button id="additionTaskOff" value="123">off</button>
                        </td>

                    </tr>
                    </tbody>

                </table>
            </div>
        </div>
        <div class="col-md-6 text-center">
            <div class="outer-form">
                <textarea id="logsArea" rows="20" cols="50" readonly>
                </textarea>
            </div>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type=text/javascript>
        function getTasksList(url){
            return $.ajax({
                url: url,
                type: 'GET',
                success: function(data){
                    populateTable(data);
                },
                error: function (error){
                    return error
                }
            });
        }
        
        function populateTable(data){
            input = '<tbody>';
            $.each(data, function (key, value) {
                input = input+'<tr>\n' +
                    '                <td style="padding: 14px;">'+value['name']+'</td>\n' +
                    '                <td style="padding: 14px;"><span id="longTaskStatus">'+value['state']+'</span></td>\n' +
                    '                <td><button class="attach" value="'+key+'">attach</button><button calss="detach" value="'+key+'">detach</button></td>\n' +
                    '                <td>\n' +
                    '                <button class="stopTask" value="'+key+'">off</button>\n</td>\n' +
                    '\n</tr>'
            });
            input = input + '</tbody>';
            $('#table').append(input)

        }
        $(function () {
            getTasksList('/tasks');

            $("#selectTask").change(function(){
                var selectedTask = $(this).children("option:selected").val();
                if ($('.nameField').length){
                    $('.nameField').remove();
                }
                if(selectedTask === 'longTask'){
                    input = $('<div class="form-group nameField">\n' +
                        '  <label for="name">Name:</label>\n' +
                        '  <input type="text" class="form-control" id="name">\n' +
                        '</div>');

                    $(".select").append(input)
                }
            });

            $("#startTask").click(function () {
                var value = '';
                var selectedTask = $(this).children("option:selected").val();
                if(selectedTask === 'long'){
                    value = $("#name").val();
                }
                var url = '/request?task_name=' + selectedTask;
                if (value !== '') {
                    url = url + '&name=' + value
                }
                getTasksList(url);
                getTasksList('/tasks')

            });
            $(".attach").click(function () {
                var value = $(".attach").val();
                //ajax request
            });

            $(".detach").click(function () {
                var value = $(".detach").val();
                //ajax request
            });

            $(".stopTask").click(function () {
                var value = $(".stopTask").val();
                //ajax request
            })

        });
    </script>
{% endblock %}